#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ –≤ Google Sheets
–î–æ–±–∞–≤–ª—è–µ—Ç 10 –º–æ–∫–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤—Ä–µ–º–µ–Ω–∞–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
"""
import os
import sys
from datetime import datetime, timedelta
import pytz
from google_sheets_client import GoogleSheetsClient

def add_test_posts():
    """–î–æ–±–∞–≤–ª—è–µ—Ç 10 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ –≤ Google Sheets"""
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç Google Sheets
    sheets_client = GoogleSheetsClient()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    if not sheets_client.service:
        print("‚ùå –û—à–∏–±–∫–∞: Google Sheets API –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:")
        print("- GOOGLE_SHEET_ID")
        print("- GOOGLE_CREDENTIALS_JSON")
        return False
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
    print("üìã –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã...")
    sheets_client.setup_headers()
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø–æ –ú–æ—Å–∫–≤–µ
    moscow_tz = pytz.timezone('Europe/Moscow')
    now = datetime.now(moscow_tz)
    
    # –°–æ–∑–¥–∞–µ–º 10 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤
    test_posts = []
    
    # –ü–æ—Å—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (–¥–Ω–µ–≤–Ω—ã–µ)
    for i in range(5):
        post_time = now + timedelta(minutes=2 + i*2)  # –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
        test_posts.append({
            "date": post_time.strftime("%d.%m.%y"),
            "time": post_time.strftime("%H:%M"),
            "text": f"<b>–¢–ï–°–¢–û–í–´–ô –ü–û–°–¢ #{i+1} (–° –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï–ú)</b><br><br>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Telegram-–∫–∞–Ω–∞–ª. –ü–æ—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç HTML-—Ä–∞–∑–º–µ—Ç–∫—É –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º.<br><br><i>–í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</i> {post_time.strftime('%H:%M')}<br><br>–≠—Ç–æ—Ç –ø–æ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.",
            "prompt_ru": "",
            "prompt_en": f"A couple in a cozy coffee shop, sitting opposite each other, sincerely laughing, completely relaxed, natural, without masks, warm lighting, atmosphere of trust, close-up, photorealistic, depth of field --test{i+1}",
            "image_urls": f"https://picsum.photos/800/600?random={i+1}",
            "status": "–û–∂–∏–¥–∞–µ—Ç"
        })
    
    # –ü–æ—Å—Ç—ã –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏ –≤–µ—á–µ—Ä–Ω–∏–µ)
    for i in range(5):
        post_time = now + timedelta(minutes=12 + i*2)  # –ù–∞—á–∏–Ω–∞—è —Å 12-–π –º–∏–Ω—É—Ç—ã, –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
        if i % 2 == 0:
            # –£—Ç—Ä–µ–Ω–Ω–∏–µ —Ü–∏—Ç–∞—Ç—ã
            test_posts.append({
                "date": post_time.strftime("%d.%m.%y"),
                "time": post_time.strftime("%H:%M"),
                "text": f"> –¢–µ—Å—Ç–æ–≤–∞—è —Ü–∏—Ç–∞—Ç–∞ #{i+1}: –õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –≤—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞, –∞ –∫–æ–≥–¥–∞ –≤—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏.",
                "prompt_ru": "",
                "prompt_en": "",
                "image_urls": "",
                "status": "–û–∂–∏–¥–∞–µ—Ç"
            })
        else:
            # –í–µ—á–µ—Ä–Ω–∏–µ –ø–æ—Å—Ç—ã
            test_posts.append({
                "date": post_time.strftime("%d.%m.%y"),
                "time": post_time.strftime("%H:%M"),
                "text": f"**–¢–ï–°–¢–û–í–´–ô –í–ï–ß–ï–†–ù–ò–ô –ü–û–°–¢ #{i+1}**\n\n–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –≤–µ—á–µ—Ä–Ω–∏–π –ø–æ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏. –ü–æ—Å—Ç –Ω–∞–ø–∏—Å–∞–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.\n\n*–í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:* {post_time.strftime('%H:%M')}\n\n–≠—Ç–æ—Ç –ø–æ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.",
                "prompt_ru": "",
                "prompt_en": "",
                "image_urls": "",
                "status": "–û–∂–∏–¥–∞–µ—Ç"
            })
    
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü—É
    print(f"üì§ –î–æ–±–∞–≤–ª—è–µ–º {len(test_posts)} —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ –≤ Google Sheets...")
    
    success_count = 0
    for i, post in enumerate(test_posts):
        try:
            result = sheets_client.add_post(post)
            if result:
                print(f"‚úÖ –ü–æ—Å—Ç {i+1}/10 –¥–æ–±–∞–≤–ª–µ–Ω: {post['date']} {post['time']}")
                success_count += 1
            else:
                print(f"‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞ {i+1}/10: {post['date']} {post['time']}")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞ {i+1}/10: {e}")
    
    print(f"\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç:")
    print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ: {success_count}/{len(test_posts)} –ø–æ—Å—Ç–æ–≤")
    print(f"‚ùå –û—à–∏–±–æ–∫: {len(test_posts) - success_count}")
    
    if success_count > 0:
        print(f"\nüéØ –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ—Å—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã!")
        print(f"‚è∞ –ü–µ—Ä–≤—ã–π –ø–æ—Å—Ç –±—É–¥–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã")
        print(f"‚è∞ –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç –±—É–¥–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —á–µ—Ä–µ–∑ {2 + (len(test_posts)-1)*2} –º–∏–Ω—É—Ç")
        print(f"üì± –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram-–∫–∞–Ω–∞–ª –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤")
    
    return success_count > 0

if __name__ == "__main__":
    print("üß™ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ –≤ Google Sheets")
    print("=" * 50)
    
    success = add_test_posts()
    
    if success:
        print("\n‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã!")
        print("üîÑ –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–∞–±–ª–∏—Ü—É –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã")
        print("üì± –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º–∏ –≤ Telegram-–∫–∞–Ω–∞–ª–µ")
    else:
        print("\n‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤")
        sys.exit(1)
